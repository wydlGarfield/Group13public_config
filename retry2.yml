#——————————————————————————————————————————————————————————————————————
  - name: setup each wordpress config
    hosts: "{{ groups.web_server.0 }}"
    remote_user: ubuntu
    gather_facts: False
    become_user: root
    become: yes
    become_method: sudo
    
    vars: 
    
      wp_mysql_db: wordpress
      wp_mysql_user: wordpress
      wp_mysql_password: admin
      wp_mysql_host: "{{ groups.database.0 }}"
      
    tasks:
    
      - name: Update WordPress config file
        lineinfile:
           dest: /var/www/html/wp-config.php
           regexp: "{{ item.regexp }}"
           line: "{{ item.line }}"
        with_items:
             - {'regexp': "define\\('DB_NAME', '(.)+'\\);", 'line': "define('DB_NAME', '{{wp_mysql_db}}');"}        
             - {'regexp': "define\\('DB_USER', '(.)+'\\);", 'line': "define('DB_USER', '{{wp_mysql_user}}');"}        
             - {'regexp': "define\\('DB_PASSWORD', '(.)+'\\);", 'line': "define('DB_PASSWORD', '{{wp_mysql_password}}');"}
             - {'regexp': "define\\('DB_Host', '(.)+'\\);", 'line': "define('DB_Host', '{{wp_mysql_host}}');"}
        become: yes

      - name: Install wordpress page         
        shell: bash wordpress.sh
        become: yes

